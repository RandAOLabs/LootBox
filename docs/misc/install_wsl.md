# Installing WSL 2 (Windows Subsystem for Linux)

This guide will help you install WSL 2 using Chocolatey package manager.

## Prerequisites

1. Install Chocolatey by following the [Chocolatey Installation Guide](install_choco.md)
2. Windows 10 version 2004 or higher / Windows 11

## Installation Steps

1. Open PowerShell as Administrator (as described in the Chocolatey guide)

2. Install WSL 2:
   ```powershell
   choco install wsl2 -y
   ```

3. Install Ubuntu (recommended Linux distribution):
   ```powershell
   wsl --install -d Ubuntu
   ```

4. Restart your computer when prompted

5. After restart, Ubuntu will launch automatically
   - Create a new user account when prompted
   - Enter a username and password

That's it! You now have WSL 2 installed with Ubuntu.

## Verification

To verify the installation, open PowerShell and run:
```powershell
wsl --status
```

You should see WSL 2 listed as the default version.

## DNS Configuration for VPN Users

If you're using a VPN (especially Cisco AnyConnect), you might experience DNS resolution issues. Here's an automatic solution to fix DNS forwarding problems:

1. Re-enable auto-generation of resolv.conf (if previously disabled):
   ```bash
   sudo nano /etc/wsl.conf
   ```
   Make sure these lines are commented out (add # at the start):
   ```bash
   #[network]
   #generateResolvConf = false
   ```

2. Create the DNS update script:
   ```bash
   sudo nano /bin/vpn-dns.sh
   ```
   Add the following content:
   ```bash
   #!/bin/bash

   echo "Getting current DNS servers, this takes a couple of seconds"

   /mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -Command '
   $ErrorActionPreference="SilentlyContinue"
   Get-NetAdapter -InterfaceDescription "Cisco AnyConnect*" | Get-DnsClientServerAddress | Select -ExpandProperty ServerAddresses
   Get-NetAdapter | ?{-not ($_.InterfaceDescription -like "Cisco AnyConnect*") } | Get-DnsClientServerAddress | Select -ExpandProperty ServerAddresses
   ' | \
           awk 'BEGIN { print "# Generated by vpn fix func on", strftime("%c"); print } { print "nameserver", $1 }' | \
           tr -d '\r' > /etc/resolv.conf
   clear
   ```

3. Make the script executable and allow sudo access:
   ```bash
   sudo chmod +x /bin/vpn-dns.sh
   echo "$(whoami) ALL=(ALL) NOPASSWD: /bin/vpn-dns.sh" | sudo tee /etc/sudoers.d/010-$(whoami)-vpn-dns
   ```

4. Configure the script to run on WSL startup:
   ```bash
   echo "/bin/vpn-dns.sh" | sudo tee /etc/profile.d/vpn-dns.sh
   ```

You can also run the script manually at any time:
```bash
sudo /bin/vpn-dns.sh
```

This solution will automatically update your DNS configuration when WSL starts and can be manually triggered when needed.
